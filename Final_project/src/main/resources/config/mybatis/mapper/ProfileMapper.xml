<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="three.profile.mapper.ProfileMapper">
	
	<insert id="insertPayment" parameterType="Payment">
		insert into payment 
		values(#{merchant_uid},#{imp_uid},#{buyer_email},#{buyer_id},#{paid_amount},sysdate)
	</insert>
	
	<update id="plusPoint" parameterType="Payment">
		update project_user set userPoint = userPoint + #{paid_amount}
		<where>
			<!-- userEmail=#{buyer_email} -->
			userId=#{buyer_id}
		</where>
	</update>
	
	<insert id="addExchange" parameterType="Exchange" >
		<selectKey keyProperty="exchangeNum" resultType="int" order="BEFORE">
			select exchange_seq.nextval from dual
		</selectKey>
		insert into exchange values(#{exchangeNum},#{bankName},#{bankAccountNum},#{userName},#{userEmail},#{userId},#{exchangePoint},sysdate)
	</insert>
	
	<update id="minusPoint" parameterType="Exchange">
		update project_user set userPoint = userPoint - #{exchangePoint}
		<where>
			<!-- userEmail = #{userEmail} -->
			userId=#{userId}
		</where>
	</update>
	
	<select id="findPaymentByUserId" resultType="Payment" parameterType="string">
		select * from payment where buyer_id = #{value}
	</select>
	
	<select id="findExchangeByUserId" resultType="Exchange" parameterType="string">
		select * from exchange where userId = #{value}
	</select>


</mapper>